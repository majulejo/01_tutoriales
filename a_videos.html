<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Buscador de Videos de YouTube</title>
  <!-- todo favicon -->
   <link rel="shortcut icon" href="youtube.png" type="image/x-icon">
   

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            youtube: '#ff0000',
          }
        }
      }
    }
  </script>
  <style>
    .edit-form, .add-form { display: none; }
    .edit-form.active, .add-form.active { display: block; margin-top: 16px; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-8 px-4">
  <div class="max-w-2xl w-full bg-white rounded-xl shadow-lg p-6">
    <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-6">
      üîç Buscador de Videos de YouTube
    </h1>

    <!-- Paso 1: Introducir URL -->
    <div id="searchSection" class="mb-8">
      <label for="youtubeUrl" class="block text-sm font-medium text-gray-700 mb-2">
        URL del video de YouTube <span class="text-red-500">*</span>
      </label>
      <div class="flex gap-2">
        <input
          type="url"
          id="youtubeUrl"
          placeholder="https://www.youtube.com/watch?v=..."
          class="flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
          required
        />
        <button
          id="searchBtn"
          class="bg-red-600 hover:bg-red-700 text-white font-semibold px-4 py-2 rounded-lg whitespace-nowrap"
        >
          Buscar
        </button>
      </div>
      <p id="searchMessage" class="mt-2 text-sm text-gray-500 min-h-[20px]"></p>
    </div>

    <!-- Paso 2: Formulario para a√±adir -->
    <div id="addFormSection" class="add-form mb-8 p-4 bg-blue-50 rounded-lg border border-blue-200">
      <h2 class="font-semibold text-gray-800 mb-3">‚ûï A√±adir nuevo video</h2>
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Descripci√≥n (opcional)</label>
          <textarea
            id="newDescription"
            placeholder="Ej: Tutorial de React"
            rows="2"
            class="w-full px-3 py-2 border border-gray-300 rounded"
          ></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Autor o canal <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="newAuthor"
            placeholder="Ej: Midudev"
            class="w-full px-3 py-2 border border-gray-300 rounded"
            required
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Guardado como (opcional)</label>
          <input
            type="text"
            id="newSavedAs"
            placeholder="Ej: Curso React - Clase 3"
            class="w-full px-3 py-2 border border-gray-300 rounded"
          />
        </div>
        <div class="flex gap-2">
          <button id="saveVideoBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
            ‚úÖ Guardar en lista
          </button>
          <button id="cancelAddBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
            Cancelar
          </button>
        </div>
      </div>
    </div>

    <!-- Controles de orden -->
    <div class="flex flex-wrap justify-between items-center gap-2 mb-4">
      <h2 class="text-lg font-semibold text-gray-800">Mi lista de videos</h2>
      <div class="flex flex-wrap gap-2">
        <button id="sortDateBtn" class="px-3 py-1 text-sm rounded border">M√°s recientes</button>
        <button id="sortAuthorBtn" class="px-3 py-1 text-sm rounded border">Por autor</button>
        <button id="sortSavedAsBtn" class="px-3 py-1 text-sm rounded border">Guardado como</button>
      </div>
    </div>

    <!-- Listado de videos -->
    <div id="videosList" class="space-y-4">
      <!-- Los videos se renderizar√°n aqu√≠ -->
    </div>
  </div>

  <script>
    let videos = JSON.parse(localStorage.getItem('youtubeVideos')) || [];
    let currentSort = localStorage.getItem('videoSort') || 'date'; // 'date', 'author', 'savedAs'

    function getYouTubeVideoId(url) {
      const regExp = /^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
      const match = url.match(regExp);
      return (match && match[2].length === 11) ? match[2] : null;
    }

    function saveAndRender() {
      localStorage.setItem('youtubeVideos', JSON.stringify(videos));
      renderVideos();
    }

    function getSortedVideos() {
      let sorted = [...videos];
      if (currentSort === 'author') {
        sorted.sort((a, b) => (a.author || '').localeCompare(b.author || '', 'es', { sensitivity: 'base' }));
      } else if (currentSort === 'savedAs') {
        sorted.sort((a, b) => (a.savedAs || '').localeCompare(b.savedAs || '', 'es', { sensitivity: 'base' }));
      } else {
        // 'date': m√°s reciente primero
        sorted.sort((a, b) => new Date(b.addedAt) - new Date(a.addedAt));
      }
      return sorted;
    }

    function renderVideos() {
      const container = document.getElementById('videosList');
      const sortedVideos = getSortedVideos();

      // Actualizar botones activos
      document.getElementById('sortDateBtn').classList.toggle('bg-gray-200', currentSort === 'date');
      document.getElementById('sortAuthorBtn').classList.toggle('bg-gray-200', currentSort === 'author');
      document.getElementById('sortSavedAsBtn').classList.toggle('bg-gray-200', currentSort === 'savedAs');

      if (sortedVideos.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center py-4">No hay videos guardados a√∫n.</p>';
        return;
      }

      container.innerHTML = sortedVideos.map(video => `
        <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 hover:shadow-sm transition-shadow">
          <div class="flex flex-col md:flex-row gap-4">
            <div class="flex-shrink-0">
              <img
                src="https://img.youtube.com/vi/${video.videoId}/mqdefault.jpg"
                alt="Miniatura"
                class="w-24 h-16 object-cover rounded-md"
                onerror="this.src='https://via.placeholder.com/120x80?text=Sin+miniatura'"
              />
            </div>
            <div class="flex-grow">
              <p class="font-medium text-gray-800 break-words">${video.description || 'Sin descripci√≥n'}</p>
              <p class="text-sm text-gray-600 mt-1">
                <span class="font-semibold text-gray-700">Autor:</span> ${video.author}
              </p>
              ${video.savedAs ? `<p class="text-sm text-gray-600 mt-1"><span class="font-semibold text-gray-700">Guardado como:</span> ${video.savedAs}</p>` : ''}
              <p class="text-xs text-gray-500 mt-1">A√±adido: ${new Date(video.addedAt).toLocaleDateString()}</p>
              <a
                href="${video.url}"
                target="_blank"
                rel="noopener noreferrer"
                class="text-blue-600 hover:underline text-sm block mt-1 truncate"
              >
                ${video.url}
              </a>
            </div>
            <div class="flex flex-shrink-0 flex-col gap-2 items-start">
              <button data-id="${video.videoId}" class="edit-btn text-blue-600 hover:text-blue-800 text-sm font-medium px-3 py-1 rounded border border-blue-300 hover:bg-blue-50">
                ‚úèÔ∏è Editar
              </button>
              <button data-id="${video.videoId}" class="delete-btn text-red-600 hover:text-red-800 text-sm font-medium px-3 py-1 rounded border border-red-300 hover:bg-red-50">
                üóëÔ∏è Borrar
              </button>
            </div>
          </div>

          <!-- Formulario de edici√≥n -->
          <div id="edit-form-${video.videoId}" class="edit-form mt-4 p-3 bg-white border rounded-lg">
            <div class="space-y-3">
              <input
                type="text"
                data-id="${video.videoId}"
                value="${video.description || ''}"
                placeholder="Nueva descripci√≥n"
                class="edit-desc w-full px-3 py-2 border border-gray-300 rounded"
              />
              <input
                type="text"
                data-id="${video.videoId}"
                value="${video.author}"
                placeholder="Nuevo autor"
                class="edit-author w-full px-3 py-2 border border-gray-300 rounded"
              />
              <input
                type="text"
                data-id="${video.videoId}"
                value="${video.savedAs || ''}"
                placeholder="Guardado como (opcional)"
                class="edit-savedas w-full px-3 py-2 border border-gray-300 rounded"
              />
              <div class="flex gap-2">
                <button data-id="${video.videoId}" class="save-edit-btn bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded text-sm">
                  Guardar
                </button>
                <button data-id="${video.videoId}" class="cancel-edit-btn bg-gray-500 hover:bg-gray-600 text-white px-3 py-1.5 rounded text-sm">
                  Cancelar
                </button>
              </div>
            </div>
          </div>
        </div>
      `).join('');

      // Eventos
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          document.getElementById(`edit-form-${id}`).classList.add('active');
        });
      });

      document.querySelectorAll('.cancel-edit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          document.getElementById(`edit-form-${id}`).classList.remove('active');
        });
      });

      document.querySelectorAll('.save-edit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          const desc = document.querySelector(`.edit-desc[data-id="${id}"]`).value.trim();
          const author = document.querySelector(`.edit-author[data-id="${id}"]`).value.trim();
          const savedAs = document.querySelector(`.edit-savedas[data-id="${id}"]`).value.trim();

          if (!author) {
            alert('‚ö†Ô∏è El autor es obligatorio.');
            return;
          }

          const videoIndex = videos.findIndex(v => v.videoId === id);
          if (videoIndex !== -1) {
            videos[videoIndex].description = desc || 'Sin descripci√≥n';
            videos[videoIndex].author = author;
            videos[videoIndex].savedAs = savedAs || null; // null si est√° vac√≠o
            saveAndRender();
          }
        });
      });

      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          if (confirm('¬øEliminar este video?')) {
            videos = videos.filter(v => v.videoId !== id);
            saveAndRender();
          }
        });
      });
    }

    // --- L√ìGICA PRINCIPAL ---

    const urlInput = document.getElementById('youtubeUrl');
    const searchBtn = document.getElementById('searchBtn');
    const messageEl = document.getElementById('searchMessage');
    const addFormSection = document.getElementById('addFormSection');

    let currentVideoId = null;
    let currentUrl = '';

    // Cambiar orden
    document.getElementById('sortDateBtn').addEventListener('click', () => {
      currentSort = 'date';
      localStorage.setItem('videoSort', 'date');
      renderVideos();
    });
    document.getElementById('sortAuthorBtn').addEventListener('click', () => {
      currentSort = 'author';
      localStorage.setItem('videoSort', 'author');
      renderVideos();
    });
    document.getElementById('sortSavedAsBtn').addEventListener('click', () => {
      currentSort = 'savedAs';
      localStorage.setItem('videoSort', 'savedAs');
      renderVideos();
    });

    // Buscar video
    searchBtn.addEventListener('click', () => {
      const url = urlInput.value.trim();
      if (!url) {
        messageEl.textContent = '‚ö†Ô∏è Introduce una URL.';
        messageEl.className = 'mt-2 text-sm text-red-600';
        return;
      }

      const videoId = getYouTubeVideoId(url);
      if (!videoId) {
        messageEl.textContent = '‚ö†Ô∏è URL de YouTube no v√°lida.';
        messageEl.className = 'mt-2 text-sm text-red-600';
        return;
      }

      if (videos.some(v => v.videoId === videoId)) {
        messageEl.textContent = '‚úÖ Este video ya est√° en tu lista.';
        messageEl.className = 'mt-2 text-sm text-green-600';
        addFormSection.classList.remove('active');
        return;
      }

      currentVideoId = videoId;
      currentUrl = url;
      messageEl.textContent = 'üé¨ Video encontrado. Completa los datos para guardarlo.';
      messageEl.className = 'mt-2 text-sm text-blue-600';
      addFormSection.classList.add('active');
      document.getElementById('newDescription').value = '';
      document.getElementById('newAuthor').value = '';
      document.getElementById('newSavedAs').value = '';
    });

    // Guardar nuevo video
    document.getElementById('saveVideoBtn').addEventListener('click', () => {
      const author = document.getElementById('newAuthor').value.trim();
      if (!author) {
        alert('‚ö†Ô∏è El autor es obligatorio.');
        return;
      }

      const description = document.getElementById('newDescription').value.trim();
      const savedAs = document.getElementById('newSavedAs').value.trim();

      videos.push({
        url: currentUrl,
        videoId: currentVideoId,
        description: description || 'Sin descripci√≥n',
        author: author,
        savedAs: savedAs || null, // null si vac√≠o
        addedAt: new Date().toISOString()
      });

      saveAndRender();
      addFormSection.classList.remove('active');
      urlInput.value = '';
      messageEl.textContent = '‚úÖ Video a√±adido correctamente.';
      messageEl.className = 'mt-2 text-sm text-green-600';
    });

    document.getElementById('cancelAddBtn').addEventListener('click', () => {
      addFormSection.classList.remove('active');
      messageEl.textContent = '';
    });

    renderVideos();
  </script>
</body>
</html>